<% breadcrumb :new_poll, @poll %>
<% breadcrumb :freeform_poll %>

<div class="portlet box red">
  <div class="portlet-title">
    <div class="caption"><i class="icon-reorder"></i>Poll</div>
    <div class="tools">
      <a href="javascript:;" class="collapse"></a>
      <a href="javascript:;" class="remove"></a>
    </div>
  </div>

  <div class="portlet-body form">
    <%= simple_form_for @poll, :html => { :multipart => true, class: "form-horizontal", id: "form-input" } do |f| %>
      <div class="form-body">
        <h3 class="form-section">Freeform Poll</h3>
          <div class="row">
            <div class="col-md-7">
              <%= f.input :type_poll, as: :hidden, input_html: { value: "freeform" } %>
              <!-- <%= f.input :title, wrapper: :horizontal, label: "Question", input_html: { data: { 'validetta' => 'required,minLength[5]' } } %> -->
              <div class="form-group">
                <div class="label-hz col-md-2"><label class="string optional control-label">Question</label></div>
                <div class="col-md-10">
                  <textarea class="form-control maxlength_textarea" id="tagged_text" rows="5" name="poll[title_with_tag]" maxlength="250" required data-parsley-range="[5,250]"></textarea>
                  <span class="help-block"><span class="label label-sm label-danger">Note:</span> Use tag by #</span>
                </div>
              </div>

              <%= f.input :choice_one, wrapper: :horizontal, label: "Choice", input_html: { :"data-parsley-required" => "true" } %>
              
              <div id="InputsWrapper">
                <div class="form-group string optional">
                  <div class="label-hz col-md-2"><label class="string optional control-label">Choice</label></div>
                  <div class="col-md-10">
                    <input type="text" name="choices[]" class="string optional form-control form-choice-list" id="field_1" value="" required>
                    <a href="#" class="removeclass"></a>
                  </div>
                </div>
              </div>
                
                <!-- <button type="button" class="remove-field btn btn-default">Remove</button> -->

              <div class="col-md-10 col-md-offset-2" id="AddMoreFileId">
                <button type="button" class="add-field btn btn-sm btn-default" id="AddMoreFileBox">More choice</button>
              </div>
            </div>

            <div class="col-md-5">
              <!-- <%= f.input :tag_tokens,wrapper: :horizontal ,:label => "Tag", :input_html => {:class => "tag_token", :id => "tag_lists" } %> -->
              <div class="form-group">
                <label class="control-label col-md-2">Campaign</label>
                <div class="col-md-10">
                  <%= f.select :campaign_id, Campaign.all.map! {|r| [r.name, r.id ] }, { include_blank: true },  { class: 'select2me_campaign', placeholder: "Select a campaign"} %>
                </div>
              </div>

              <div class="form-group">
                <label class="control-label col-md-2">Recurring</label>
                <div class="col-md-10">
                  <%= f.select :recurring_id, list_recurring.map! { |r| [ r.description + " รันทุกๆ  " + r.period.strftime("%H:%M") + " น.", r.id.to_i]}, { include_blank: true },  { class: 'select2me_campaign', placeholder: "Select a recurring"} %>
                </div>
              </div>
              <%= f.input :expire_date, collection: 1..20,  wrapper: :horizontal, label: "Expire", include_blank: false, input_html: { class: 'input-xsmall'} %>
            </div>

          
      </div>

      <div class="form-actions fluid">
        <div class="row">
           <div class="col-md-7">
              <div class="col-md-offset-2 col-md-9">
                 <button type="submit" class="btn blue"><i class="icon-ok"></i> Submit</button>
                 <%= link_to 'Discard', polls_path, method: :get, class: 'btn default' %>                              
              </div>
           </div>
           <div class="col-md-6">
           </div>
        </div>
       </div>

      <% end %>
  </div>

</div>


<script type="text/javascript">
  $('.tag_token').select2('data', <%= raw @poll_tags.to_json %>);
  $("#form-input").parsley();
</script>

<script>
$(document).ready(function() {
  var MaxInputs       = 10; //maximum extra input boxes allowed
  var InputsWrapper   = $("#InputsWrapper"); //Input boxes wrapper ID
  var AddButton       = $("#AddMoreFileBox"); //Add button ID

  var x = InputsWrapper.length; //initlal text box count
  var FieldCount=1; //to keep track of text box added

  //on add input button click
  $(AddButton).click(function (e) {
    //max input box allowed
    if(x <= MaxInputs) {
        FieldCount++; //text box added ncrement
        //add input box
        $(InputsWrapper).append('<div class="form-group string optional"><div class="label-hz col-md-2"><label class="string optional control-label">Choice</label></div><div class="col-md-10"><input type="text" name="choices[]" class="string optional form-control form-choice-list" id="field_1" value="" required><a href="#" class="removeclass"><i class="icon-remove"></i></a></div></div>');
        x++; //text box increment
        
        $("#AddMoreFileId").show();
        
        $('AddMoreFileBox').html("Add field");
        
        // Delete the "add"-link if there is 3 fields.
        if(x == 10) {
          $("#AddMoreFileId").hide();
          $("#lineBreak").html("<br>");
        }
    }
    return false;
  });

  $("body").on("click",".removeclass", function(e){ //user click on remove text
    if( x > 1 ) {
            $(this).parent('div').parent('div').remove(); //remove text box
            console.log($(this).parent('div').parent('div'))
            x--; //decrement textbox
        
          $("#AddMoreFileId").show();
        
          $("#lineBreak").html("");

          // Adds the "add" link again when a field is removed.
          $('AddMoreFileBox').html("Add field");
    }
    return false;
  }) 
});
</script>
