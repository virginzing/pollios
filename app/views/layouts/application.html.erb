<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= content_for?(:title) ? yield(:title) : "Pollios" %></title>

    <%= stylesheet_link_tag    "application" %>
    <%= javascript_include_tag "vendor/modernizr" %>
    <%= javascript_include_tag "application" %>
    <%= csrf_meta_tags %>

    <link rel="stylesheet" href="/stylesheets/bootstrap-fileupload.css" >
    <link rel="stylesheet" href="/stylesheets/select2.css">

  </head>

  <body>

  <div class="">
    <nav class="top-bar" data-topbar>
      <ul class="title-area">
        <!-- Title Area -->
        <li class="name">
          <h1><a href="<%= root_url %>">Pollios</a></h1>
        </li>
        <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
        <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
      </ul>

      <section class="top-bar-section">
      <ul class="left">
      <li><a href="<%= members_path %>">Member All</a></li>
      </ul>

        <!-- Right Nav Section -->
        <ul class="right">
          <li class="divider hide-for-small"></li>
          <% if signed_in? %>
            <li><a href="<%= campaigns_path %>">Campaign</a></li>
            <li class="divider"></li>
            <li><a href="<%= recurrings_path %>">Recurring</a></li>
            <li class="divider"></li>

            <li class="has-dropdown not-click"><a href="<%= poll_series_index_path %>">Series Poll</a>
            <ul class="dropdown"><li class="title back js-generated"></li>
              <li><%= link_to 'New Series', new_poll_series_path, method: :get %></li>
            </ul>
            </li>
            <li class="divider"></li>

            <li class="has-dropdown not-click"><a href="<%= polls_path %>">Poll</a>
            <ul class="dropdown"><li class="title back js-generated"></li>
              <li><a href="<%= new_poll_path %>">New Poll</a></li>
            </ul>

            </li>
            <li class="divider"></li>
            <li class="has-dropdown not-click <%= active_class("profile") %>">
            <%= image_tag(current_member.avatar, size: '32x32', class: 'img-profile img-circle') %>
            <a href="#"><div class="name-profile"><%= truncate(current_member.sentai_name, length: 15) %></div></a>
              <ul class="dropdown">
                <li><%= link_to 'Profile', member_profile_path %></li>
                <li><%= link_to 'Sign out', authen_signout_url, method: :delete %></li>
              </ul>
            </li>
            <% else %>
            <li><%= link_to 'Sign in', authen_signin_url %></li>
          <% end %>
        </ul>
      </section>
    </nav>
  </div>

    <% flash.each do |key, value| %>
      <div data-alert class="<%= flash_class(key) %> fade in">
        <% if value.class == Array %>
          <dl style="margin-bottom: 0.25em;">
          <%= puts "values => #{value}" %>
            <% value.each do |data| %>
              <li><%= data %></li>
            <% end %>
          </dl>
        <% else %>
          <%= value %>
        <% end %>
        <a href="#" class="close">&times;</a>
      </div>
    <% end %>


  
    <div class="row">
      <div class="large-12 columns">
        <%= yield %>
      </div>
    </div>
    <!--
    <script type="text/javascript" src="/javascripts/jquery.tokeninput.js"></script>
    <script>
        $("#tag_list").tokenInput("/tags.json", {
          theme: "facebook",
          prePopulate: $('#tag_list').data('load'),
          preventDuplicates: true,
          tokenLimit: 3
        });
    </script>
    -->
    <script type="text/javascript" src="/javascripts/select2.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.datetimepicker.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.0.1-p7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/javascripts/bootstrap-fileupload.js"></script>
    <script type="text/javascript">
    $(document).ready(function() {
      $(".tag_token").select2({
          width: "937px",
          placeholder: "Search tag",
          minimumInputLength: 2,
          multiple: true,
          ajax: {
              url: "/tags.json",
              dataType: 'json',
              data: function (term, page) {
                  return {
                    q: term
                  };
              },
              results: function (data, page) {
                  return { results: data };
              }
          }
      });

      $('.tag_token').select2('data', <%= raw @poll_tags.to_json %> )

      $("#poll_group_id").select2({
        width: "970px",
        placeholder: "Select a group (Option)",
        allowClear: true
      });

      $("#select_campaign").select2({
        width: "970px",
        placeholder: "Select a campaign",
      });

      $("#select_campaign_series").select2({
        width: "940px",
        placeholder: "Select a campaign",
      });

      $("#campaign_poll_ids").select2({
        width: "970px",
        multiple: true,
        placeholder: "Select a poll",
        query: function (query){
          var data = {results: []};
 
            $.each(<%= raw @poll_campaign_new.to_json %>, function(){
                if(query.term.length == 0 || this.text.toUpperCase().indexOf(query.term.toUpperCase()) >= 0 ){
                    data.results.push({id: this.id, text: this.text });
                }
            });
   
            query.callback(data);
        }
      });
      $('#campaign_poll_ids').select2('data', <%= raw @poll_campaigns.to_json %> )
      
      $("#poll_recurring_id").select2({
          width: "970px",
          placeholder: "Select a recurring",
          allowClear: true
      });
    });
    </script>
    <script>
      $('#datetimepicker').datetimepicker();
      $('#questionnaire_normal').datetimepicker();
      $('#questionnaire_same_choice').datetimepicker();
    </script>
  </body>
</html>